@page
@model BankBarden.Pages.CustomersModel
@{
}

<div class="add-top-padding">
    <div class="container">

        @if (Model.Country != 0){
            <h1>All customers from @Model.Country</h1>
        }
        else{
            <h1>All customers</h1>
        }

        <h3>Page @Model.CurrentPage</h3>

        <a class="btn btn-primary add-smal-pading-around" asp-area="" asp-page="/CustomerCRUD/CreateCustomer">Creat new Customer</a>

        <form method="get">
            <input asp-for="@Model.Quastion"/>
            <input type="hidden" asp-for="@Model.Country"/>
            <input type="submit" value="Search"/>
        </form>




        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">
                        Id
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="Id"
                        asp-route-sortOrder="asc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-up"></i>

                        </a>
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="Id"
                        asp-route-sortOrder="desc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-down"></i>
                        </a>
                    </th>

                    <th scope="col">
                        Name
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="Name"
                        asp-route-sortOrder="asc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-up"></i>

                        </a>
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="Name"
                        asp-route-sortOrder="desc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-down"></i>
                        </a>
                    </th>

                    <th scope="col">
                        City
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="City"
                        asp-route-sortOrder="asc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-up"></i>

                        </a>
                        <a asp-page="/Customers"
                        asp-route-country="@Model.Country"
                        asp-route-quastion="@Model.Quastion"
                        asp-route-pageNumb="@Model.CurrentPage"
                        asp-route-sortColumn="City"
                        asp-route-sortOrder="desc"
                        style="text-decoration:none">
                            <i class="fa-solid fa-angle-down"></i>
                        </a>
                    </th>
                    <th scope="col">Country</th>
                    <th scope="col">Accounts</th>
                    <th scope="col">Info</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cust in Model.Customers)
                {
                    <tr>
                        <td>@cust.Id</td>
                        <td>@cust.Name</td>
                        <td>@cust.City</td>
                        <td>@cust.Country</td>


                        <td>
                            <a onclick="javascript:fetchEvaluation(@cust.Id, this)"
                               class="btn btn-primary">
                                Get value
                            </a>
                        </td>




                        <td>
                            <a asp-page="CustomerInfo"
                            asp-route-custId="@cust.Id"
                            class="btn btn-primary">
                                Show Info
                            </a>
                        </td>

                    </tr>
                }
                <tr>
                    @if (Model.CurrentPage != 1)
                    {
                        <td>
                            <a class="btn btn-secondary"
                            asp-page="/Customers"
                            asp-route-country="@Model.Country"
                            asp-route-quastion="@Model.Quastion"
                            asp-route-sortColumn="@Model.Culom"
                            asp-route-sortOrder="@Model.Order"
                            asp-route-pageNumb="@(Model.CurrentPage-1)">
                                Prev
                            </a>
                        </td>
                    }
                    else
                    {
                        <td></td>
                    }
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    @if (Model.CurrentPage != Model.MaxPage)
                    {
                        <td>
                            <a class="btn btn-secondary"
                            asp-page="/Customers"
                            asp-route-country="@Model.Country"
                            asp-route-quastion="@Model.Quastion"
                            asp-route-sortColumn="@Model.Culom"
                            asp-route-sortOrder="@Model.Order"
                            asp-route-pageNumb="@(Model.CurrentPage+1)">
                                Next
                            </a>
                        </td>
                    }
                    else
                    {
                        <td></td>
                    }
                </tr>


            </tbody>
        </table>
    </div>
</div>


@section Scripts
{
    <script>
        function fetchEvaluation(id, elem) {
            fetch("Customers?handler=FetchValue&customerId=" + id)
                .then((response) => response.json())
                .then((json) => {
                    elem.innerHTML = json.value;
                });
        }
    </script>
}


